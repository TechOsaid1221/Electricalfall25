<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Assignment Viewer</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

    <style>
        /* 1. Basic Protections */
        body {
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none;    /* Firefox */
            -ms-user-select: none;     /* IE/Edge */
            user-select: none;         /* Standard */
            background-color: #525659;
            overflow-x: hidden;
        }

        /* 2. PDF Container */
        #pdf-render-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            /* Smooth transition for the blur effect */
            transition: filter 0.3s ease;
        }

        /* 3. The Canvas (Page Images) */
        canvas {
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            max-width: 100%;
            height: auto;
            border-radius: 2px;
        }

        /* --- SCREENSHOT DETERRENT STYLES --- */

        /* The blur effect class */
        .is-blurred {
            filter: blur(20px) grayscale(100%) !important;
        }

        /* An overlay that appears when blurred to explain why */
        #blur-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            color: white;
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
            text-align: center;
        }
        
        /* Show overlay when body has the blur class */
        body.blur-active #blur-overlay {
            display: flex;
        }
        
        /* Hide content on Print */
        @media print {
            body { display: none !important; }
        }

        #loader { color: white; margin-top: 50px; text-align: center; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="blur-overlay">
        <h1>⚠️ Security Pause</h1>
        <p>Content is hidden while the window is not active.</p>
        <p>Click back here to resume viewing.</p>
    </div>

    <div class="container-fluid">
        <div id="loader">
            <div class="spinner-border text-light" role="status">...</div>
            <p class="mt-2">Loading Secure Document...</p>
        </div>

        <div id="pdf-render-container"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // === CONFIGURATION ===
        // RENAME YOUR PDF FILE TO 'file.pdf' AND PUT IT IN THE FOLDER
        const url = 'file.pdf'; 

        // === PDF RENDERER (Same as before) ===
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
        const container = document.getElementById('pdf-render-container');
        const loader = document.getElementById('loader');

        pdfjsLib.getDocument(url).promise.then(pdf => {
            loader.style.display = 'none';
            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                pdf.getPage(pageNum).then(page => {
                    // Scale 1.5 is decent quality for screen viewing
                    const viewport = page.getViewport({ scale: 1.5 });
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    container.appendChild(canvas);
                    page.render({ canvasContext: context, viewport: viewport });
                });
            }
        }).catch(err => {
             loader.innerHTML = `<div class="alert alert-danger">Error: ${err.message}<br>Ensure 'file.pdf' exists and you are using a local server.</div>`;
        });


        // === SECURITY FEATURES ===

        // 1. Key Blocking (Ctrl+P, S, C, PrintScreen)
        document.addEventListener('keydown', function(e) {
            // Try to detect PrintScreen key (doesn't work on all OSs)
            if (e.key === 'PrintScreen') {
                 blurContent();
                 e.preventDefault();
                 return false;
            }
            // Block Ctrl/Cmd hotkeys
            if ((e.ctrlKey || e.metaKey) && ['p', 's', 'u', 'c'].includes(e.key.toLowerCase())) {
                e.preventDefault();
                alert('Action disabled for security.');
                return false;
            }
        });

        // 2. --- THE SCREENSHOT "BLUR" DETERRENT ---
        const pdfContainer = document.getElementById('pdf-render-container');

        function blurContent() {
            pdfContainer.classList.add('is-blurred');
            document.body.classList.add('blur-active');
        }

        function unblurContent() {
            pdfContainer.classList.remove('is-blurred');
            document.body.classList.remove('blur-active');
        }

        // Activate blur when window loses focus (e.g., clicking snipping tool)
        window.addEventListener('blur', blurContent);

        // Remove blur when they click back onto the page
        window.addEventListener('focus', unblurContent);
        
        // Initial check to ensure it's visible on load
        if (document.hasFocus()) {
            unblurContent();
        } else {
            blurContent();
        }

    </script>
</body>
</html>
